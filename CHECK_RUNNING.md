# ✅ 確認程式持續運行的方法

## 方法 1：本地測試（推薦先做）

### 直接執行
```bash
python main.py
```

### 你應該看到的輸出

**啟動階段（前 10 秒）：**
```
======================================================================
🚀 MACD 監控系統啟動中...
======================================================================
⏰ 啟動時間: 2024-11-22 04:00:00
🌐 Flask 服務準備中...
======================================================================

✅ Flask 服務準備就緒，開始監聽 port 10000...
======================================================================

* Running on http://0.0.0.0:10000

======================================================================
🤖 監控執行緒啟動中...
======================================================================

============================================================
🤖 開始監控台指期 MACD 背離訊號（AI 自動學習版）
============================================================
📌 指標系統：標準 MACD (12, 26, 9)
📌 學習功能：自動收集數據、分析勝率、優化參數
📌 當前參數：slope=3.0, lookback=10
============================================================
```

**運行階段（每 3 秒）：**
```
📊 [1] 抓取價格: 23,150 | 14:30:15
📊 [2] 抓取價格: 23,150 | 14:30:18
📊 [3] 抓取價格: 23,155 | 14:30:21
...
📊 [10] 抓取價格: 23,160 | 14:30:45
```

**心跳訊息（每 60 秒）：**
```
💓 心跳 #20 | 2024-11-22 14:31:00 | 監控運行中...
💓 心跳 #40 | 2024-11-22 14:32:00 | 監控運行中...
💓 心跳 #60 | 2024-11-22 14:33:00 | 監控運行中...
```

**Keep-alive（每 10 分鐘）：**
```
🔄 Keep-alive 功能啟動（每 10 分鐘自動喚醒）
Pinged self to stay awake
```

**資料收集完成（約 5 小時後）：**
```
============================================================
✅ 資料量已足夠，開始監控！
============================================================
📊 當前有 60 根 5 分鐘 K 棒
📈 最新價格: 23,150
⚙️ 監控參數: slope=3.0, lookback=10
============================================================
```

**狀態更新（每 3 分鐘）：**
```
📊 14:35:00 | 價格: 23,180 | K棒: 65 | MACD: +2.35 | 循環: #60
📊 14:38:00 | 價格: 23,200 | K棒: 66 | MACD: +3.12 | 循環: #120
```

---

## 方法 2：使用測試腳本

```bash
python test_run.py
```

這會啟動程式並即時顯示所有輸出，方便觀察。

---

## 方法 3：Render 部署後檢查

### 在 Render Dashboard 查看 Logs

1. 登入 https://dashboard.render.com/
2. 點擊你的服務 "danny-macd"
3. 點擊 "Logs" 標籤
4. 應該看到相同的輸出訊息

### 關鍵指標

✅ **程式正常運行的標誌：**
- 看到 "Flask 服務準備就緒"
- 看到 "開始監控台指期 MACD 背離訊號"
- 每 60 秒看到 "💓 心跳" 訊息
- 每 10 分鐘看到 "Pinged self to stay awake"

❌ **程式有問題的標誌：**
- 沒有任何輸出
- 輸出後就停止了
- 看到錯誤訊息（紅色）
- 沒有心跳訊息

---

## 方法 4：網頁檢查

### 訪問狀態頁面

**本地：**
```
http://localhost:10000/status
```

**Render：**
```
https://danny-macd.onrender.com/status
```

應該顯示：
- ✅ 系統運行中
- 📊 訊號統計
- 🔔 最新訊號

### 如果看到錯誤

表示程式沒有正常運行，需要檢查 Logs。

---

## 方法 5：Telegram 確認

### 等待通知

如果程式正常運行：
- 當有訊號時會收到 Telegram 通知
- 參數優化時也會收到通知

### 測試 Telegram

可以手動測試 Telegram 是否正常：

```python
import requests

BOT_TOKEN = "你的 BOT_TOKEN"
CHAT_ID = "你的 CHAT_ID"
API_URL = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"

requests.post(API_URL, data={
    "chat_id": CHAT_ID, 
    "text": "🧪 測試訊息 - MACD 監控系統"
})
```

---

## 🔍 故障排除

### 問題 1：本地執行沒有輸出

**原因：** 程式卡住或錯誤
**解決：**
```bash
python main.py 2>&1 | tee output.log
```
這會將所有輸出（包括錯誤）儲存到 `output.log`

### 問題 2：Render 上沒有心跳訊息

**原因：** 監控執行緒沒啟動
**解決：** 查看 Logs 是否有錯誤訊息

### 問題 3：一直顯示 "SERVICE WAKING UP"

**原因：** 程式啟動失敗
**解決：** 
1. 檢查 Logs 的錯誤訊息
2. 確認 `DATABASE_URL` 環境變數已設定
3. 手動重新部署

### 問題 4：心跳訊息停止了

**原因：** 程式崩潰或被終止
**解決：**
1. 查看 Logs 最後的訊息
2. 檢查是否有錯誤
3. 重新啟動服務

---

## 📊 正常運行的時間軸

```
00:00 - 啟動程式
00:01 - Flask 服務就緒
00:06 - 監控執行緒啟動
00:16 - Keep-alive 啟動
01:00 - 第一個心跳訊息
05:00 - 資料收集完成，開始監控
05:03 - 第一次狀態更新
...   - 持續運行
```

---

## ✅ 快速檢查清單

- [ ] 本地執行看到啟動訊息
- [ ] 看到 "Flask 服務準備就緒"
- [ ] 看到 "開始監控台指期 MACD 背離訊號"
- [ ] 每 60 秒看到心跳訊息
- [ ] 每 10 分鐘看到 "Pinged self to stay awake"
- [ ] 網頁 `/status` 可以訪問
- [ ] Render Logs 顯示相同訊息
- [ ] 沒有錯誤訊息

如果以上都打勾，表示程式正常運行！ 🎉
